<app-header/>
<div class="container">
  <h2>Gestión de Usuarios</h2>

  <!-- Buscador -->
  <div class="search-bar">
    <input type="text"
           [(ngModel)]="searchTerm"
           placeholder="Buscar por nombre, email, RUT o teléfono..."
           (keyup.enter)="onSearch()">
    <button (click)="onSearch()">Buscar</button>
  </div>

  @if (isLoading) {
    <div class="loading">
      <p>Cargando usuarios...</p>
    </div>
  } @else {
    @if (users.length > 0) {
      <table class="user-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tipo</th>
            <th>Nombre</th>
            <th>RUT</th>
            <th>Fecha Ingreso</th>
            <th>Email</th>
            <th>Teléfono</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (user of filledUsers; track $index) {
            <tr [class.empty-row]="user.is_empty">
              <td>{{ user.id || '---' }}</td>
              <td>{{ user.tipo_usuario }}</td>
              <td>{{ user.nombre_completo }}</td>
              <td>{{ user.rut }}</td>
              <td>{{ user.fecha_ingreso }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.phone }}</td>
              <td>
                @if (!user.is_empty) {
                  <button (click)="openDeleteDialog(user.id)" class="delete-btn">
                    Eliminar
                  </button>
                } @else {
                  <button disabled class="delete-btn" style="opacity: 0.5;">Eliminar</button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Paginación -->
      <div class="pagination">
        <button [disabled]="currentPage === 1"
                (click)="changePage(currentPage - 1)">
          Anterior
        </button>

        <span>Página {{ currentPage }} de {{ totalPages }}</span>

        <button [disabled]="currentPage >= totalPages"
                (click)="changePage(currentPage + 1)">
          Siguiente
        </button>
      </div>
    } @else {
      <div class="no-users">
        No se encontraron usuarios.
      </div>
    }
  }

  <dialog #confirmDialog class="dialog">
    <h3>Confirmar eliminación</h3>
    <p>¿Estás seguro de eliminar este usuario?</p>
    <div class="dialog-actions">
      <button (click)="closeDialog()" class="cancel-btn">Cancelar</button>
      <button (click)="confirmDelete()" class="confirm-btn">Eliminar</button>
    </div>
  </dialog>
</div>
<app-footer/>
